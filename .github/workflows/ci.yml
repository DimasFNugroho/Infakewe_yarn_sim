name: CI (Chrono cross-platform)

on:
  push:
  pull_request:

jobs:
  test:
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, windows-latest]
    runs-on: ${{ matrix.os }}

    steps:
      - uses: actions/checkout@v4

      - name: Set up Miniconda (Python 3.10)
        uses: conda-incubator/setup-miniconda@v3
        with:
          # Create & activate from the env file below
          activate-environment: chrono
          environment-file: env/environment.base.yml

          # Important: avoid "defaults" and ToS prompts
          channels: projectchrono,conda-forge
          conda-remove-defaults: true
          channel-priority: strict

          auto-update-conda: false
          conda-solver: libmamba

      - name: Show environment
        run: |
          conda run -n chrono python -V
          conda run -n chrono conda list

      - name: Run tests
        run: conda run -n chrono pytest -q
